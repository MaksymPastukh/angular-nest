<div class="mx-auto w-full max-w-3xl px-2 py-2">
  <!-- Индикатор загрузки -->
  @if (store.isLoading()) {
    <div class="flex justify-center py-8">
      <div
        class="h-8 w-8 animate-spin rounded-full border-4 border-blue-600 border-t-transparent"
      ></div>
    </div>
  }

  <!-- Ошибка -->
  @if (store.error()) {
    <div class="mb-4 rounded-lg bg-red-50 p-4 text-red-800 dark:bg-red-900/20 dark:text-red-400">
      {{ store.error() }}
    </div>
  }

  <!-- Форма нового комментария -->
  <form (submit)="onCreateComment($event)" class="mb-12">
    <!-- Текст комментария -->
    <div
      class="rounded-lg border border-gray-200 bg-white p-6 transition-shadow focus-within:shadow-md"
    >
      <textarea
        [value]="newCommentText()"
        (input)="newCommentText.set($any($event.target).value)"
        (keydown.enter)="onCreateComment($event)"
        placeholder="Напишите комментарий..."
        class="w-full resize-none bg-transparent text-sm text-gray-800 placeholder:text-gray-400 focus:outline-none"
        rows="3"
      ></textarea>

      <div class="mt-3 flex justify-end">
        <button
          type="submit"
          [disabled]="!newCommentText().trim()"
          class="rounded-lg bg-purple-600 font-causten cursor-pointer font-bold text-lg px-5 py-2 text-sm font-medium text-white transition hover:bg-purple-800 active:scale-95 disabled:bg-purple-300 disabled:cursor-not-allowed"
        >
          @if (store.isLoading()) {
            <span class="animate-pulse">Sending…</span>
          } @else {
            <span>Post comment</span>
          }
        </button>
      </div>
    </div>
  </form>

  <!-- Список комментариев -->
  @if (store.hasComments()) {
    <div class="space-y-6">
      @for (comment of store.comments(); track comment.id) {
        <app-comment-item
          [comment]="comment"
          [currentUserId]="authStore.user()?.user?.id ?? null"
          [isUserAdmin]="authStore.isAdmin()"
          (like)="onToggleLike($event)"
          (delete)="onDeleteComment($event)"
        />
      }
    </div>
  } @else if (store.commentsCount() === 0) {
    <div class="py-12 text-center text-gray-500 dark:text-gray-400">
      <p class="text-lg">Комментариев пока нет</p>
      <p class="mt-2 text-sm">Будьте первым, кто оставит отзыв!</p>
    </div>
  }
</div>
