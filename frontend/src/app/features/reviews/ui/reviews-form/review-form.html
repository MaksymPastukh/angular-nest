<div class="mx-auto w-full max-w-3xl">
  <!-- Ошибка rating (если нужно показывать) -->
  @if (reviewsForm.rating().touched() && reviewsForm.rating().invalid()) {
    @if (reviewsForm.rating().errors().length > 0) {
      <div class="mt-2 text-xs text-red-600">
        {{ reviewsForm.rating().errors()[0].message }}
      </div>
    }
  }

  <!-- Форма отзыва -->
  <form (submit)="submitForm($event)" class="mb-12">
    <div
      class="rounded-lg border border-gray-200 bg-white p-6 transition-shadow focus-within:shadow-md"
    >
      <!-- Text -->
      <div class="mt-1">
        <textarea
          [formField]="reviewsForm.text"
          placeholder="Напишите отзыв..."
          class="w-full resize-none bg-transparent text-sm text-gray-800 placeholder:text-gray-400 focus:outline-none"
          rows="4"
        ></textarea>

        <div class="mt-2 flex items-center justify-between text-xs text-gray-500">
          <div>
            @if (reviewsForm.text().touched() && reviewsForm.text().invalid()) {
              @if (reviewsForm.text().errors().length > 0) {
                <span class="text-red-600">{{ reviewsForm.text().errors()[0].message }}</span>
              }
            }
          </div>

          <div>{{ reviewsForm().value().text.length }}/1000</div>
        </div>
      </div>

      <div class="mt-3 flex justify-between font-family font-medium text-lg">
        <!-- Rating -->
        <div class="flex items-start justify-between gap-4">
          <div class="flex items-end gap-3">
            <span class="text-gray-600">Your review</span>

            <app-ui-rating
              [value]="reviewsForm().value().rating"
              [stars]="5"
              [readonly]="false"
              [disabled]="!isAuthenticated() || isSubmitting()"
              (rateCommitted)="setRating($event ?? 5)"
              (cancelCommitted)="resetRating()"
            />
          </div>
        </div>
        <button
          type="submit"
          [disabled]="!isAuthenticated() || isSubmitting() || reviewsForm().invalid()"
          class="bg-purple-600 rounded-lg cursor-pointer font-bold text-lg px-5 py-2 text-sm font-medium text-white transition hover:bg-purple-800 active:scale-95 disabled:bg-purple-300 disabled:cursor-not-allowed"
        >
          @if (isSubmitting()) {
            <span class="animate-pulse">Sending…</span>
          } @else {
            <span>
              @if (isEditMode()) {
                Update review
              } @else {
                Post review
              }
            </span>
          }
        </button>
      </div>
    </div>
  </form>
</div>
